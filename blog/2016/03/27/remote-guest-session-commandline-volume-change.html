<!DOCTYPE html>
<html>
  	<head>
      <title>Remote PulseAudio volume change script for a guest-session user</title>
  		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
      
      
        <meta name="keywords" content="LinuxMint,guest-session,PulseAudio,ssh,command-line,script" />
      
  		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
  		<script src="/js/jquery.min.js"></script>
  		<script src="/js/jquery.poptrox.min.js"></script>
  		<script src="/js/skel.min.js"></script>
  		<script src="/js/init.js"></script>
  		<noscript>
  			<link rel="stylesheet" href="/css/skel.css" />
  			<link rel="stylesheet" href="/css/style.css" />
  			<link rel="stylesheet" href="/css/style-xlarge.css" />
  		</noscript>
  		<!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
  	</head>

	<body id="top">
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=1545300899113871";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>
      <header id="header">
          <a href="/aboutme.html" class="image avatar"><img src="/images/avatar.jpg" alt="" /></a>
          <h1><strong>I am <a href="/aboutme">Dolf Andringa</a></strong>, an ecologist, geek and software developer.
            This site contains my personal ramblings.</h1>
      </header>
      <!-- Main -->
        <nav>
          <ul>
              <li><a href="/">Home</a></li>
              <li><a href="/projects.html">Projects</a></li>
              <li><a href="/aboutme.html">About Me</a></li>
              <li><a href="/archive/">Archive</a></li>
          </ul>
        </nav>
      <div id="main">


            <article>
        <header class="major">
            <h2 class="post-title">Remote PulseAudio volume change script for a guest-session user</h2>
                <p class="post-meta">
                  Mar 27, 2016
                  
                  
                  <span class="tags">
                    Tags:  <a href="/tag/LinuxMint">LinuxMint</a>  <a href="/tag/guest-session">guest-session</a>  <a href="/tag/PulseAudio">PulseAudio</a>  <a href="/tag/ssh">ssh</a>  <a href="/tag/command-line">command-line</a>  <a href="/tag/script">script</a> 
                  </span>
                </p>
        </header>

        <section>
            <p>I live and have setup the IT infrastructure for an NGO where I share my living space with volunteers. Generally the volunteers are hard workers and well behaved, but once in a while on a Saturday night they have a good time, which often involves turning the music up just a little too high. As I am usually already in my own little house a few 10’s of meters away, I don’t always share their enjoyment. But I don’t want to nag them and am also way too lazy to go out and turn the music down. As the computer they use to play the music on runs Linux Mint and I can access it from my home through the wifi, I thought I’d create a script that allows me to change the volume on the computer remotely.</p>

<p>The problem is that they login using a guest-session, so every time they login, they get a different username and ID. And PulseAudio runs as that user, so if I change the volume as my own user I get a permission denied error. The following script first determines the username and uid of the user that they login as (line 1-3). Next (line 4-8) it determines the volume change direction from a command-line argument (if up is specified the volume goes up by 10% else down by 10%).
Then (line 11) it actually runs the command as the guest user. One thing you seem to need to do is set the XDG_RUNTIME_DIR environment variable for the user, which PulseAudio seems to use for something. If I run this script (or the alias I specified in my .bashrc) with sudo, it changes the volume correctly.
No more sleepless nights.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="c">#!/bin/bash</span>
<span class="nv">username</span><span class="o">=</span><span class="sb">`</span>who|grep <span class="s2">"^guest[a-zA-Z0-9</span><span class="se">\-</span><span class="s2">]</span><span class="se">\+</span><span class="s2">"</span> -o<span class="sb">`</span>
<span class="nv">uid</span><span class="o">=</span><span class="sb">`</span>id -u <span class="nv">$username</span><span class="sb">`</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$1</span> <span class="o">==</span> <span class="s1">'up'</span> <span class="o">]]</span>;<span class="k">then
    </span><span class="nv">dir</span><span class="o">=</span><span class="s1">'10%+'</span>
<span class="k">else
    </span><span class="nv">dir</span><span class="o">=</span><span class="s1">'10%-'</span>
<span class="k">fi
</span>su - <span class="nv">$username</span> -c <span class="s2">"XDG_RUNTIME_DIR=/run/user/</span><span class="nv">$uid</span><span class="s2"> amixer -D pulse sset Master </span><span class="nv">$dir</span><span class="s2">"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>


        </section>
        
        <footer>
          <div class="fb-comments" id="FC" data-href="" data-width="600" data-numposts="10"></div>
          <script type="text/javascript" language="javascript">jQuery(“#FC”).attr(“data-href”, window.location.href.split(‘?’)[0]);</script>');
        </footer>

    </article>


      </div>

        <!-- Footer -->
        <footer id="footer">
            <ul class="icons">
              
              
              <li>
                <a href="https://stackoverflow.com/users/867162" class="icon fa-stack-overflow">
                  <span class="label">GitHub</span>
                </a>
              </li>
              

              
              <li>
                <a href="https://github.com/dolfandringa" class="icon fa-github">
                  <span class="label">GitHub</span>
                </a>
              </li>
              

              

              
              <li>
                <a href="https://linkedin.com/in/dolfandringa" class="icon fa-linkedin">
                  <span class="label">LinkedIn</span>
                </a>
              </li>
              

              
              <li>
                <a href="https://plus.google.com/+dolfandringa" class="icon fa-google-plus">
                  <span class="label">Google+</span>
                </a>
              </li>
              

              

              

              
              <li>
                <a href="mailto:dolfandringa@gmail.com" class="icon fa-envelope-o">
                  <span class="label">Email</span>
                </a>
              </li>
              
            </ul>
            <ul class="copyright">
                <li>&copy; Dolf Andringa 2005</li>
            </ul>
          
            <script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-72709986-1', 'auto');
              ga('send', 'pageview');

            </script>

        </footer>

	</body>
</html>
